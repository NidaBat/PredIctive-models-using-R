---
title: "Prediction Assignment Writeup"
author: "Nida Batt"
date: "8/14/2017"
output: html_document
---
# Executive Summary
The main goal of the project is to predict the manner in which 6 participants perform the dumbell exercise. The participants performed one set of 10 repetitions of the Unilateral Dumbbell Biceps Curl in five different fashions:
Class A: Exactly according to the specification.
Class B: Throwing the elbows to the front.
Class C: Lifting the dumbbell only halfway.
Class D: Lowering the dumbbell only halfway.
Class E: Throwing the hips to the front.

The training data for this project are [available here.](https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv)

The test data are [available here.](https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv)

The data for this project come from [this source.](http://web.archive.org/web/20161224072740/http:/groupware.les.inf.puc-rio.br/har)

# Data Processing
```{r}
setwd("~/Desktop/coursera")
```

### Download required libraries
```{r, message=FALSE, warning=FALSE, results='hide'}
install.packages("caret", repos="REPOLINK")
library(caret)
install.packages("randomForest", dependencies = TRUE, repos="REPOLINK")
library(randomForest)
install.packages("ggplot2", repos="REPOLINK")
library(ggplot2)
```

### Download files from "Human Activity Recognition" Data Set 
#### Check if file already exists
```{r, message=FALSE, warning=FALSE, results='hide'}
if(!file.exists("./data")){
    dir.create("./data")
}

### Download trian file
fileUrl1 <- "https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv?accessType=DOWNLOAD"
download.file(fileUrl1, destfile = "./data/pml-training.csv", method = "curl")
dateDownloaded <- date()
### Download test file
fileUrl2 <- "https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv?accessType=DOWNLOAD"
download.file(fileUrl2, destfile = "./data/pml-testing.csv", method = "curl")
dateDownloaded <- date()
```
```{r, message=FALSE, warning=FALSE, results='hide'}
### Read train file
trainingI <- read.csv("./data/pml-training.csv",  stringsAsFactors=FALSE, header = TRUE)
```
```{r, message=FALSE, warning=FALSE, results='hide'}
### Summarize the data
str(trainingI)
head(trainingI)
summary(trainingI)
```
```{r}
dim(trainingI)
```
There are 19622 observations and 160 variables in the trainingI data set. After analyzing the data set, we observe lots of missing values and also, there are some columns that have no impact on the prediction. So we have to clean the data before processing it.

# Data Cleaning
#### Remove first seven columns of training data set as its an ID'-Number's and time stamp data
```{r}
training <- trainingI[, -c(1:7)]
dim(training)
```
#### Remove NearZeroVariance variables (caret package)
```{r}
nzv_cols <- nearZeroVar(training)
if(length(nzv_cols) > 0) training <- training[, -nzv_cols]
dim(training)
```
#### Remove columns with more than 60% NA values
```{r, results= 'hide'}
training <- training[, -which(colMeans(is.na(training)) > 0.6)]
dim(training)
summary(training)
```
# Partioning the training set into two data sets
We will split our data set into a training data set (60% of the total cases) and a testing data set (40% of the total cases). This will allow us to estimate the out of sample error of our predictor.
```{r}
# Training set
inTrain <- createDataPartition(y = training$classe, p = 0.6, list = FALSE)
HARTraining <- training[inTrain,]
dim(HARTraining)
```

```{r}
# Testing set
HARTesting <- training[-inTrain,]
dim(HARTesting)
```
# Prediction
After getting the clean data set from the above processing, we will use multipe methods to fit our model. 

#### Using Random Forest method
```{r, message=FALSE, warning=FALSE}
set.seed(1234)
cv <- trainControl(method="cv", number=3)
modFit_rf <- train(classe ~.,data=HARTraining, method="rf", trControl=cv, verbose=F)
```
#### Using lda(linear discriminant analysis) method
```{r, message=FALSE, warning=FALSE}
set.seed(1234)
modFit_lda <- train(classe ~ .,data=HARTraining,method="lda", trControl = cv)
```
#### Predict rf model and evaluate error using the HARTesting data set
```{r, message=FALSE, warning=FALSE}
prediction_rf <- predict(modFit_rf,newdata=HARTesting)
confusionMatrix(prediction_rf,HARTesting$classe)$overall
```

#### Predict lda models and evaluate error using the HARTesting data set
```{r, message=FALSE, warning=FALSE}
prediction_lda <- predict(modFit_lda, newdata = HARTesting)
confusionMatrix(prediction_lda, HARTesting$classe)$overall
```

```{r, message=FALSE, warning=FALSE, results= 'hide'}
library(ggplot2)
```
#### Graphical represation of the predictions
```{r fig1, fig.height = 4, fig.width = 5, fig.align = "center"}
qplot(prediction_rf, prediction_lda,color = classe, data = HARTesting)
```
We use HARTesting data set to evaluate the performance of our models. The accuracy of `rf` model is `0.99` and the accuracy of lda model is `7.03`. 
Based on the above accuracy values, we pick `rf` model for final prediction.

Finally, we load the `testing` data file and predict the result using `rf` model as follows:

## Read test file
```{r, message=FALSE, warning=FALSE}
testingI <- read.csv("./data/pml-testing.csv",  stringsAsFactors=FALSE, header = TRUE)
dim(testingI)
```

```{r, message=FALSE, warning=FALSE}
testing <- testingI[,names(testingI) %in% names(HARTraining)] 
predict_result <- predict(modFit_rf, newdata = testing, predict.all = TRUE)
predict_result
```
Output of prediction is the predicted probability of the 5 levels (columns) of outcome (A, B, C, D, E).

# Conclusion
In this project, we were able to fit a model that predicts with over 99 percent accuracy the class of dumbell exercises given a series of movements. A random forest model proved to be the most accurate model, however it is also computationally intensive and may take a long time if the number of variables increases greatly.